<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Shop | Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #6366f1; 
            --primary-hover: #4f46e5;
            --dark: #0f172a; 
            --bg: #f8fafc; 
            --success: #10b981; 
            --danger: #ef4444;
            --glass: rgba(255, 255, 255, 0.8);
        }

        body { 
            margin: 0; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); 
            color: var(--dark);
            scroll-behavior: smooth;
        }
        
        /* Header / Hero */
        .hero { 
            background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%); 
            color: white; 
            padding: 60px 20px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .hero h1 { margin: 0; font-size: 2.5rem; letter-spacing: -1px; }
        .hero p { opacity: 0.8; margin-top: 10px; }

        /* Product Grid */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 25px; 
            max-width: 1200px; 
            margin: -30px auto 50px; 
            padding: 0 20px; 
        }
        
        .card { 
            background: white; 
            border-radius: 20px; 
            padding: 25px; 
            text-align: center; 
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .card:hover { 
            transform: translateY(-10px); 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        .card img { width: 70px; height: 70px; image-rendering: pixelated; margin-bottom: 15px; }
        .card h3 { margin: 10px 0 5px; font-size: 1.1rem; }
        
        .buy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        .buy-btn:hover { background: var(--primary-hover); }

        /* Floating Cart Toggle */
        .cart-toggle { 
            position: fixed; bottom: 30px; right: 30px; 
            padding: 18px 28px; background: var(--dark); 
            color: white; border-radius: 50px; cursor: pointer; 
            border: none; z-index: 100; font-weight: bold;
            box-shadow: 0 10px 15px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 10px;
        }

        /* Cart Panel */
        #cart-panel { 
            position: fixed; bottom: 100px; right: 30px; 
            width: 350px; background: white; border-radius: 24px; 
            display: none; flex-direction: column; 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); 
            z-index: 101; border: 1px solid #eee; overflow: hidden;
        }

        /* Fullscreen Chat UI */
        #chat-page { 
            display: none; position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; background: #fff; 
            z-index: 9999; flex-direction: column; 
        }
        .chat-header { 
            background: var(--dark); color: white; padding: 20px 25px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .chat-messages { 
            flex: 1; padding: 25px; overflow-y: auto; 
            display: flex; flex-direction: column; gap: 12px; 
            background: #f1f5f9;
        }
        
        /* Message Bubbles */
        .msg { padding: 12px 18px; border-radius: 18px; font-size: 14px; max-width: 75%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .u-msg { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .a-msg { background: white; color: var(--dark); align-self: flex-start; border-bottom-left-radius: 4px; }
        
        /* Link Reminder Box */
        .link-box { 
            background: #dbeafe; border-left: 4px solid var(--primary); 
            padding: 15px; margin: 15px; border-radius: 12px; 
            font-size: 0.85rem; position: relative;
        }
        
        /* Input Styling */
        .input-box { 
            width: 100%; padding: 14px; border: 1px solid #e2e8f0; 
            border-radius: 12px; margin-bottom: 10px; box-sizing: border-box;
            font-family: inherit; transition: border 0.2s;
        }
        .input-box:focus { border-color: var(--primary); outline: none; }

        .send-btn {
            background: var(--primary); color: white; 
            border: none; padding: 0 25px; border-radius: 12px; 
            font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="shop-page">
    <div class="hero">
        <h1>Infinite Shop</h1>
        <p>Premium Minecraft Marketplace</p>
    </div>
    
    <div class="grid" id="productGrid"></div>
    
    <button class="cart-toggle" onclick="toggleCart()">
        <span>ðŸ›’</span> <span>Kurv</span> <span id="cartCount" style="background:var(--primary); padding:2px 8px; border-radius:10px; font-size:12px;">0</span>
    </button>

    <div id="cart-panel">
        <div style="padding:20px; background:var(--dark); color:white; font-weight:bold; display:flex; justify-content:space-between;">
            <span>Din Bestilling</span>
            <span onclick="toggleCart()" style="cursor:pointer; opacity:0.7;">âœ•</span>
        </div>
        <div id="cartItems" style="padding:20px; flex:1; overflow-y:auto; max-height: 250px; background:#fafafa;"></div>
        <div style="padding:20px; border-top:1px solid #eee;">
            <input type="text" id="mcName" placeholder="Minecraft Navn" class="input-box">
            <input type="password" id="orderPass" placeholder="Lag et chat-passord" class="input-box">
            <button onclick="placeOrder()" style="width:100%; background:var(--success); color:white; padding:15px; border:none; border-radius:12px; cursor:pointer; font-weight:800; font-size:1rem; transition: transform 0.1s;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'">BEKREFT BESTILLING</button>
        </div>
    </div>
</div>

<div id="chat-page">
    <div class="chat-header">
        <div>
            <div style="font-size: 0.7rem; opacity: 0.6; text-transform: uppercase; letter-spacing: 1px;">Sikker Chat</div>
            <strong id="orderTitle" style="font-size: 1.1rem;">Status</strong>
        </div>
        <button onclick="location.href=location.pathname" style="background:rgba(255,255,255,0.1); color:white; border:none; padding:10px 15px; border-radius:10px; cursor:pointer; font-weight:600;">Lukk</button>
    </div>
    
    <div id="linkReminder" class="link-box">
        <strong>ðŸ”‘ Lagre tilgangen din</strong><br>
        <span id="shareUrl" style="word-break: break-all; opacity: 0.7; font-size: 11px;"></span><br>
        <button onclick="copyUrl()" style="background:var(--primary); color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; margin-top:10px; font-size: 12px; font-weight: bold;">Kopier Link</button>
    </div>

    <div class="chat-messages" id="chatBox"></div>
    
    <div style="padding:20px; display:flex; gap:10px; background:white; border-top:1px solid #eee;">
        <input type="text" id="msgInp" placeholder="Skriv en melding..." class="input-box" style="margin:0;">
        <button onclick="sendChat()" class="send-btn">Send</button>
    </div>
</div>

<script>
    // Samme logikk som fÃ¸r, men med oppdatert UI-hÃ¥ndtering
    const DB_URL = "https://infiniteshop-98f69-default-rtdb.europe-west1.firebasedatabase.app";
    const WEBHOOK = "https://discord.com/api/webhooks/1467952378144624681/eYXQSuHoHn9MBFcA4FsaANkSjgbJ2ncNoOICyY3uMoxXbYl0mIrqyqvqvimd0eIhAsfO";

    const items = [
        { id: 1, n: "Diamond Helmet", p: 21, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Helmet.png" },
        { id: 2, n: "Diamond Chestplate", p: 38, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Chestplate.png" },
        { id: 3, n: "Diamond Leggings", p: 28, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Leggings.png" },
        { id: 4, n: "Diamond Boots", p: 16, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Boots.png" },
        { id: 5, n: "Netherite Upgrade", p: 108, c: "Diamonds", img: "https://minecraft.wiki/images/Invicon_Netherite_Upgrade.png" },
        { id: 6, n: "Totem of Undying", p: 48, c: "Diamonds", img: "https://minecraft.wiki/images/Invicon_Totem_of_Undying.png" },
        { id: 7, n: "Netherite Ingot", p: 70, c: "Diamonds", img: "https://minecraft.wiki/images/Invicon_Netherite_Ingot.png" },
        { id: 8, n: "Iron Sword", p: 32, c: "Coal", img: "https://minecraft.wiki/images/Invicon_Iron_Sword.png" },
        { id: 9, n: "Diamond Sword", p: 45, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Sword.png" },
        { id: 10, n: "Mystery Box", p: 50, c: "Iron", img: "https://raw.githubusercontent.com/mathworkproject/image/refs/heads/main/Chest.png" },
        { id: 11, n: "Diamond Pickaxe", p: 45, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Pickaxe.png" },
        { id: 12, n: "Iron Pickaxe", p: 25, c: "Coal", img: "https://minecraft.wiki/images/Invicon_Iron_Pickaxe.png" },
        { id: 13, n: "Diamond Axe", p: 38, c: "Iron", img: "https://minecraft.wiki/images/Invicon_Diamond_Axe.png" },
        { id: 14, n: "Iron Axe", p: 17, c: "Coal", img: "https://minecraft.wiki/images/Invicon_Iron_Axe.png" },
        { id: 15, n: "Potato", p: 1, c: "Coal", img: "https://minecraft.wiki/images/Invicon_Potato.png" },
        { id: 16, n: "Carrots", p: 1, c: "Coal", img: "https://minecraft.wiki/images/Invicon_Carrot.png" },
        { id: 17, n: "Cooked Mutton", p: 3, c: "Coal", img: "https://minecraft.wiki/images/Invicon_Cooked_Mutton.png" }
    ];

    let cart = {};
    let poll;

    function initProducts() {
        document.getElementById('productGrid').innerHTML = items.map(p => `
            <div class="card">
                <img src="${p.img}">
                <h3>${p.n}</h3>
                <div style="font-size:14px; font-weight:bold; color:var(--primary); margin-bottom:15px;">${p.p} ${p.c}</div>
                <button class="buy-btn" onclick="addToCart(${p.id})">Legg i kurv</button>
            </div>
        `).join('');
    }

    function addToCart(id) { cart[id] = (cart[id] || 0) + 1; updateCartUI(); }
    function updateCartUI() {
        let count = 0, html = "";
        for (let id in cart) {
            count += cart[id];
            html += `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;background:white;padding:10px;border-radius:10px;">
                <span style="font-size:13px;"><b>${cart[id]}x</b> ${items.find(i=>i.id==id).n}</span>
                <button onclick="delete cart[${id}];updateCartUI()" style="border:none;background:none;color:var(--danger);cursor:pointer;font-weight:bold;">âœ•</button>
            </div>`;
        }
        document.getElementById('cartCount').innerText = count;
        document.getElementById('cartItems').innerHTML = html || "<div style='text-align:center; opacity:0.5; padding:20px;'>Kurven er tom</div>";
    }

    function toggleCart() { 
        const p = document.getElementById('cart-panel'); 
        p.style.display = (p.style.display === 'flex') ? 'none' : 'flex'; 
    }

    async function placeOrder() {
        const name = document.getElementById('mcName').value.trim();
        const pass = document.getElementById('orderPass').value.trim();
        if(!name || !pass || Object.keys(cart).length === 0) return alert("Vennligst fyll ut navn og passord!");

        const orderId = "ORD-" + Math.floor(Math.random() * 9000 + 1000);
        const orderList = Object.keys(cart).map(id => `${cart[id]}x ${items.find(i=>i.id==id).n}`).join(", ");

        await fetch(`${DB_URL}/orders/${orderId}.json`, {
            method: 'PUT',
            body: JSON.stringify({ user: name, pass: pass, items: orderList, status: "Ny" })
        });

        fetch(WEBHOOK, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ content: `ðŸš€ **Ny Bestilling!**\n**Fra:** ${name}\n**Passord:** ${pass}\n**ID:** ${orderId}\n**Varer:** ${orderList}` })
        });

        window.location.search = `?ordre=${orderId}`;
    }

    function copyUrl() {
        navigator.clipboard.writeText(window.location.href);
        alert("Link kopiert!");
    }

    async function checkURL() {
        const params = new URLSearchParams(window.location.search);
        const orderId = params.get('ordre');
        if(!orderId) return;

        const res = await fetch(`${DB_URL}/orders/${orderId}.json`);
        const data = await res.json();
        
        if(!data) return alert("Ugyldig ordrenummer!");

        const enteredPass = prompt("Skriv inn passord for " + orderId + ":");
        if(enteredPass === data.pass) {
            document.getElementById('shareUrl').innerText = window.location.href;
            openChat(orderId);
        } else {
            alert("Feil passord!");
            window.location.search = "";
        }
    }

    function openChat(id) {
        document.getElementById('shop-page').style.display = 'none';
        document.getElementById('chat-page').style.display = 'flex';
        document.getElementById('orderTitle').innerText = "Ordre #" + id.split('-')[1];

        poll = setInterval(async () => {
            const res = await fetch(`${DB_URL}/orders/${id}.json`);
            const data = await res.json();
            if(!data) return location.reload();

            if(data.messages) {
                document.getElementById('chatBox').innerHTML = Object.values(data.messages).map(m => `
                    <div class="msg ${m.role === 'user' ? 'u-msg' : 'a-msg'}">${m.text}</div>
                `).join('');
                document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
            }
        }, 2000);
    }

    async function sendChat() {
        const inp = document.getElementById('msgInp');
        const id = new URLSearchParams(window.location.search).get('ordre');
        if(!inp.value.trim() || !id) return;
        await fetch(`${DB_URL}/orders/${id}/messages.json`, { method: 'POST', body: JSON.stringify({ role: 'user', text: inp.value }) });
        inp.value = "";
    }

    initProducts();
    checkURL();
</script>
</body>
</html>
